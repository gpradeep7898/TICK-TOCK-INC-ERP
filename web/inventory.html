<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TICK TOCK INC. | Inventory Management</title>
<style>
/* â”€â”€ Reset & Root â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:    #1e2a3a;
  --navy2:   #243347;
  --navy3:   #162130;
  --sidebar-w: 240px;
  --header-h:  60px;
  --blue:    #2563eb;
  --blue-h:  #1d4ed8;
  --blue-l:  #3b82f6;
  --blue-bg: rgba(37,99,235,.08);
  --green:   #10b981;
  --yellow:  #f59e0b;
  --red:     #ef4444;
  --orange:  #f97316;
  --purple:  #8b5cf6;
  --bg:      #f0f4f8;
  --bg2:     #e8eef5;
  --card:    #ffffff;
  --border:  #dde5ef;
  --border2: #c8d5e5;
  --text0:   #0f1923;
  --text1:   #374151;
  --text2:   #64748b;
  --text3:   #94a3b8;
  --radius:  10px;
  --radius-sm: 6px;
  --shadow:  0 1px 3px rgba(15,25,40,.08),0 4px 16px rgba(15,25,40,.06);
  --shadow-lg: 0 4px 24px rgba(15,25,40,.12),0 1px 4px rgba(15,25,40,.08);
}
html,body{height:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text0);font-size:13px;line-height:1.5}
button{cursor:pointer;font-family:inherit;font-size:13px}
input,select,textarea{font-family:inherit;font-size:13px}
a{color:var(--blue);text-decoration:none}

/* â”€â”€ Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app{display:flex;height:100vh;overflow:hidden}

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sidebar{
  width:var(--sidebar-w);min-width:var(--sidebar-w);
  background:var(--navy);display:flex;flex-direction:column;
  overflow:hidden;z-index:100;
}
.sidebar-logo{
  padding:18px 20px 16px;border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;align-items:center;gap:12px;flex-shrink:0;
}
.sidebar-logo-icon{
  width:36px;height:36px;border-radius:9px;
  background:linear-gradient(135deg,var(--blue),var(--blue-l));
  display:flex;align-items:center;justify-content:center;
  font-size:18px;flex-shrink:0;box-shadow:0 4px 12px rgba(37,99,235,.4);
}
.sidebar-logo-text .co{font-size:13px;font-weight:800;color:#fff;letter-spacing:.03em}
.sidebar-logo-text .sub{font-size:9.5px;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:.1em}

.sidebar-nav{padding:12px 10px;flex:1;overflow-y:auto}
.nav-section{margin-bottom:4px}
.nav-label{
  font-size:9.5px;font-weight:700;color:rgba(255,255,255,.3);
  text-transform:uppercase;letter-spacing:.12em;
  padding:10px 10px 4px;
}
.nav-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 10px;border-radius:var(--radius-sm);
  color:rgba(255,255,255,.55);font-size:13px;font-weight:500;
  cursor:pointer;transition:all .12s;margin-bottom:1px;
  border:none;background:none;width:100%;text-align:left;
}
.nav-item:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.85)}
.nav-item.active{background:rgba(37,99,235,.25);color:#fff}
.nav-item .ni{font-size:15px;width:18px;text-align:center;flex-shrink:0}
.nav-badge{
  margin-left:auto;background:var(--red);color:#fff;
  font-size:10px;font-weight:700;border-radius:10px;
  padding:1px 6px;min-width:18px;text-align:center;
}
.nav-badge-yellow{background:var(--yellow);color:#000}

.sidebar-footer{
  padding:12px 16px;border-top:1px solid rgba(255,255,255,.08);
  font-size:11px;color:rgba(255,255,255,.3);
  display:flex;align-items:center;justify-content:space-between;
}

/* â”€â”€ Main Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#main{flex:1;display:flex;flex-direction:column;overflow:hidden}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#header{
  height:var(--header-h);min-height:var(--header-h);
  background:var(--card);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 24px;gap:16px;
  z-index:50;flex-shrink:0;
}
.header-page-title{font-size:16px;font-weight:700;color:var(--text0);flex:1}
.header-actions{display:flex;align-items:center;gap:12px}

.notif-btn{
  width:36px;height:36px;border-radius:var(--radius-sm);
  background:none;border:1.5px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  font-size:16px;color:var(--text2);transition:all .12s;position:relative;
}
.notif-btn:hover{background:var(--bg);border-color:var(--border2)}
.notif-dot{
  position:absolute;top:5px;right:5px;width:7px;height:7px;
  border-radius:50%;background:var(--red);border:1.5px solid var(--card);
}

.user-chip{
  display:flex;align-items:center;gap:9px;padding:5px 12px 5px 5px;
  background:var(--bg);border:1.5px solid var(--border);border-radius:30px;
  cursor:pointer;transition:all .12s;
}
.user-chip:hover{background:var(--bg2);border-color:var(--border2)}
.user-avatar{
  width:28px;height:28px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;font-weight:700;color:#fff;flex-shrink:0;
}
.user-info{line-height:1.3}
.user-name{font-size:12px;font-weight:600;color:var(--text0)}
.user-role{font-size:10px;color:var(--text2)}
.role-badge{
  font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;
  padding:2px 7px;border-radius:4px;
}
.role-admin    {background:rgba(245,158,11,.12);color:#b45309}
.role-warehouse{background:rgba(16,185,129,.12);color:#047857}
.role-sales    {background:rgba(37,99,235,.12);color:#1d4ed8}

.signout-btn{
  padding:7px 14px;border:none;border-radius:var(--radius-sm);
  background:none;color:var(--text2);font-size:12px;font-weight:500;
  border:1.5px solid var(--border);transition:all .12s;
}
.signout-btn:hover{background:var(--red);color:#fff;border-color:var(--red)}

/* â”€â”€ Content Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#content{flex:1;overflow-y:auto;padding:24px}

/* â”€â”€ Page sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page{display:none}
.page.active{display:block}

/* â”€â”€ KPI Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.kpi-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:20px;box-shadow:var(--shadow);transition:box-shadow .12s;
}
.kpi-card:hover{box-shadow:var(--shadow-lg)}
.kpi-label{font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.06em;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.kpi-label .ki{font-size:14px}
.kpi-value{font-size:28px;font-weight:800;color:var(--text0);line-height:1}
.kpi-value.blue{color:var(--blue)}
.kpi-value.green{color:var(--green)}
.kpi-value.red{color:var(--red)}
.kpi-value.yellow{color:var(--yellow)}
.kpi-sub{font-size:11px;color:var(--text3);margin-top:6px}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.card-header{
  padding:16px 20px;display:flex;align-items:center;gap:12px;
  border-bottom:1px solid var(--border);
}
.card-title{font-size:14px;font-weight:700;color:var(--text0);flex:1}
.card-body{padding:0}

/* â”€â”€ Toolbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toolbar{display:flex;align-items:center;gap:10px;margin-bottom:16px;flex-wrap:wrap}
.search-wrap{position:relative;flex:1;min-width:200px;max-width:340px}
.search-wrap input{
  width:100%;padding:8px 12px 8px 36px;
  border:1.5px solid var(--border);border-radius:var(--radius-sm);
  background:var(--card);color:var(--text0);outline:none;
  transition:border-color .12s,box-shadow .12s;
}
.search-wrap input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:14px;pointer-events:none}
.filter-select{
  padding:8px 12px;border:1.5px solid var(--border);border-radius:var(--radius-sm);
  background:var(--card);color:var(--text1);outline:none;cursor:pointer;
  transition:border-color .12s;
}
.filter-select:focus{border-color:var(--blue)}

/* â”€â”€ Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tab-bar{display:flex;gap:4px;background:var(--bg2);padding:4px;border-radius:var(--radius-sm);margin-bottom:16px}
.tab{
  padding:7px 14px;border-radius:6px;border:none;background:none;
  color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;
  transition:all .12s;white-space:nowrap;
}
.tab.active{background:var(--card);color:var(--blue);box-shadow:0 1px 3px rgba(0,0,0,.1)}
.tab:hover:not(.active){color:var(--text0)}

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:8px 14px;border-radius:var(--radius-sm);border:none;
  font-size:12px;font-weight:600;cursor:pointer;transition:all .12s;
  white-space:nowrap;
}
.btn-primary{background:var(--blue);color:#fff}
.btn-primary:hover{background:var(--blue-h)}
.btn-ghost{background:none;border:1.5px solid var(--border);color:var(--text1)}
.btn-ghost:hover{background:var(--bg);border-color:var(--border2)}
.btn-danger{background:none;border:1.5px solid transparent;color:var(--red)}
.btn-danger:hover{background:rgba(239,68,68,.08);border-color:var(--red)}
.btn-success{background:var(--green);color:#fff}
.btn-success:hover{background:#059669}
.btn-warning{background:var(--yellow);color:#000}
.btn-warning:hover{background:#d97706}
.btn-sm{padding:5px 10px;font-size:11px}
.btn-icon{width:30px;height:30px;padding:0;justify-content:center;font-size:14px}

/* â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{
  padding:10px 14px;text-align:left;font-size:11px;font-weight:700;
  color:var(--text2);text-transform:uppercase;letter-spacing:.06em;
  background:var(--bg);border-bottom:1px solid var(--border);
  white-space:nowrap;
}
thead th.sort-asc::after{content:' â†‘'}
thead th.sort-desc::after{content:' â†“'}
thead th[data-sort]{cursor:pointer;user-select:none}
thead th[data-sort]:hover{color:var(--text0)}
tbody tr{border-bottom:1px solid var(--border);transition:background .1s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:var(--bg)}
tbody tr:nth-child(even){background:rgba(240,244,248,.6)}
tbody tr:nth-child(even):hover{background:var(--bg)}
td{padding:10px 14px;color:var(--text1);vertical-align:middle}
td .cell-main{font-weight:600;color:var(--text0)}
td .cell-sub{font-size:11px;color:var(--text2);margin-top:1px}

/* â”€â”€ Status Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge{
  display:inline-flex;align-items:center;gap:4px;
  padding:3px 8px;border-radius:20px;font-size:10px;font-weight:700;
  text-transform:uppercase;letter-spacing:.06em;white-space:nowrap;
}
.badge::before{content:'â—';font-size:7px}
.badge-green {background:rgba(16,185,129,.12);color:#047857}
.badge-yellow{background:rgba(245,158,11,.12);color:#b45309}
.badge-red   {background:rgba(239,68,68,.12);color:#b91c1c}
.badge-blue  {background:rgba(37,99,235,.12);color:#1d4ed8}
.badge-gray  {background:rgba(100,116,139,.1);color:#475569}
.badge-purple{background:rgba(139,92,246,.12);color:#7c3aed}
.badge-orange{background:rgba(249,115,22,.12);color:#c2410c}

/* â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty-state{
  padding:60px 20px;text-align:center;
}
.empty-icon{font-size:40px;margin-bottom:12px;opacity:.5}
.empty-title{font-size:15px;font-weight:700;color:var(--text1);margin-bottom:6px}
.empty-sub{font-size:13px;color:var(--text2);max-width:300px;margin:0 auto}

/* â”€â”€ Pagination â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pagination{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 20px;border-top:1px solid var(--border);
  font-size:12px;color:var(--text2);
}
.page-btns{display:flex;gap:4px}
.page-btn{
  width:30px;height:30px;border:1.5px solid var(--border);border-radius:var(--radius-sm);
  background:none;cursor:pointer;color:var(--text1);font-size:12px;
  display:flex;align-items:center;justify-content:center;transition:all .12s;
}
.page-btn:hover:not(:disabled){background:var(--bg);border-color:var(--border2)}
.page-btn.active{background:var(--blue);border-color:var(--blue);color:#fff}
.page-btn:disabled{opacity:.4;cursor:not-allowed}

/* â”€â”€ Skeleton loader â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.skeleton{
  background:linear-gradient(90deg,var(--bg) 25%,var(--bg2) 50%,var(--bg) 75%);
  background-size:200% 100%;animation:shimmer 1.5s infinite;
  border-radius:4px;display:inline-block;
}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.skel-row td{padding:12px 14px}
.skel-cell{height:14px;border-radius:3px}

/* â”€â”€ Toast Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast-container{
  position:fixed;bottom:24px;right:24px;z-index:9999;
  display:flex;flex-direction:column;gap:10px;pointer-events:none;
}
.toast{
  display:flex;align-items:flex-start;gap:12px;
  padding:13px 16px;border-radius:var(--radius);
  background:var(--text0);color:#fff;
  box-shadow:0 8px 32px rgba(0,0,0,.2);
  font-size:13px;pointer-events:all;
  animation:slideIn .25s ease;max-width:340px;
  border-left:3px solid transparent;
}
.toast.success{background:#0f1923;border-left-color:var(--green)}
.toast.error  {background:#0f1923;border-left-color:var(--red)}
.toast.warning{background:#0f1923;border-left-color:var(--yellow)}
.toast.info   {background:#0f1923;border-left-color:var(--blue)}
.toast-icon{font-size:16px;flex-shrink:0;margin-top:1px}
.toast-body{flex:1;line-height:1.4}
.toast-title{font-weight:700;font-size:13px;color:#fff}
.toast-msg{font-size:12px;color:rgba(255,255,255,.6);margin-top:2px}
.toast-close{background:none;border:none;color:rgba(255,255,255,.4);font-size:16px;cursor:pointer;padding:0;flex-shrink:0}
.toast-close:hover{color:#fff}
@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}

/* â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(15,25,40,.6);
  z-index:1000;display:flex;align-items:center;justify-content:center;
  padding:24px;opacity:0;pointer-events:none;transition:opacity .2s;
}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{
  background:var(--card);border-radius:14px;box-shadow:var(--shadow-lg);
  width:100%;max-width:560px;max-height:90vh;overflow-y:auto;
  transform:scale(.95);transition:transform .2s;
}
.modal-overlay.open .modal{transform:scale(1)}
.modal-header{
  padding:20px 24px 16px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:12px;
}
.modal-title{font-size:16px;font-weight:700;color:var(--text0);flex:1}
.modal-close{
  width:32px;height:32px;border:none;background:var(--bg);
  border-radius:var(--radius-sm);cursor:pointer;color:var(--text2);
  font-size:16px;display:flex;align-items:center;justify-content:center;
  transition:all .12s;
}
.modal-close:hover{background:var(--bg2);color:var(--text0)}
.modal-body{padding:24px}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px}

/* â”€â”€ Form Fields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
.form-group input,.form-group select,.form-group textarea{
  width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:var(--radius-sm);
  background:var(--bg);color:var(--text0);outline:none;
  transition:border-color .12s,box-shadow .12s;
}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{
  border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1);background:var(--card);
}
.form-group input.error,.form-group select.error{border-color:var(--red)}
.form-group .field-error{font-size:11px;color:var(--red);margin-top:4px}
.form-group textarea{resize:vertical;min-height:70px}

/* â”€â”€ Alerts / Alert Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.alert-bar{
  padding:12px 16px;border-radius:var(--radius-sm);
  display:flex;align-items:flex-start;gap:10px;margin-bottom:16px;font-size:13px;
}
.alert-info{background:rgba(37,99,235,.06);border:1px solid rgba(37,99,235,.2);color:#1d4ed8}
.alert-warning{background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.2);color:#b45309}
.alert-error{background:rgba(239,68,68,.06);border:1px solid rgba(239,68,68,.2);color:#b91c1c}

/* â”€â”€ Reorder Alert Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#reorderBanner{
  display:none;background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.25);
  border-radius:var(--radius);padding:12px 16px;margin-bottom:16px;
  display:flex;align-items:center;gap:12px;cursor:pointer;
  transition:background .12s;
}
#reorderBanner:hover{background:rgba(245,158,11,.12)}
#reorderBanner.hidden{display:none!important}
.banner-icon{font-size:20px}
.banner-text{flex:1}
.banner-title{font-weight:700;color:#92400e;font-size:13px}
.banner-sub{font-size:12px;color:#b45309}

/* â”€â”€ Movement History Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.history-row{padding:10px 0;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;gap:12px}
.history-row:last-child{border-bottom:none}
.history-badge{width:8px;height:8px;border-radius:50%;margin-top:5px;flex-shrink:0}
.history-info{flex:1}
.history-qty{font-size:13px;font-weight:700}
.history-qty.pos{color:var(--green)}
.history-qty.neg{color:var(--red)}

/* â”€â”€ Print button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media print{
  #sidebar,#header,#toast-container,.toolbar,.tab-bar,.btn,.no-print{display:none!important}
  #content{padding:0}
  .card{box-shadow:none;border:none}
}

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:900px){
  #sidebar{display:none}
  .kpi-grid{grid-template-columns:1fr 1fr}
}
@media(max-width:600px){
  .kpi-grid{grid-template-columns:1fr}
  .form-row{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div id="app">

<!-- â”€â”€ Sidebar â”€â”€ -->
<aside id="sidebar">
  <div class="sidebar-logo">
    <div class="sidebar-logo-icon">â±</div>
    <div class="sidebar-logo-text">
      <div class="co">TICK TOCK INC.</div>
      <div class="sub">ERP v1.0.0</div>
    </div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section">
      <div class="nav-label">Inventory</div>
      <button class="nav-item active" onclick="showPage('dashboard')">
        <span class="ni">ğŸ“Š</span> Dashboard
      </button>
      <button class="nav-item" onclick="showPage('catalog')">
        <span class="ni">ğŸ“¦</span> Item Catalog
      </button>
      <button class="nav-item" onclick="showPage('stock')">
        <span class="ni">ğŸ­</span> Stock Overview
      </button>
      <button class="nav-item" id="navReorder" onclick="showPage('reorder')">
        <span class="ni">âš ï¸</span> Reorder Alerts
        <span class="nav-badge nav-badge-yellow" id="reorderNavBadge" style="display:none">0</span>
      </button>
      <button class="nav-item" onclick="showPage('adjustments')">
        <span class="ni">ğŸ“</span> Adjustments
      </button>
    </div>
    <div class="nav-section">
      <div class="nav-label">Operations</div>
      <a class="nav-item" href="/sales">
        <span class="ni">ğŸ›’</span> Sales Orders
      </a>
      <a class="nav-item" href="/purchasing">
        <span class="ni">ğŸ“‹</span> Purchasing
      </a>
      <a class="nav-item" href="/financials">
        <span class="ni">ğŸ’°</span> Financials
      </a>
    </div>
  </nav>
  <div class="sidebar-footer">
    <span id="versionFooter">v1.0.0</span>
    <span id="uptimeDisplay"></span>
  </div>
</aside>

<!-- â”€â”€ Main â”€â”€ -->
<div id="main">
  <!-- Header -->
  <header id="header">
    <div class="header-page-title" id="headerTitle">Dashboard</div>
    <div class="header-actions">
      <button class="notif-btn" id="notifBtn" title="Alerts" onclick="showPage('reorder')">
        ğŸ””<span class="notif-dot" id="notifDot" style="display:none"></span>
      </button>
      <div class="user-chip" id="userChip">
        <div class="user-avatar" id="userAvatar" style="background:#2563eb">?</div>
        <div class="user-info">
          <div class="user-name" id="userName">Loadingâ€¦</div>
          <div class="user-role"><span class="role-badge" id="userRoleBadge">â€¦</span></div>
        </div>
      </div>
      <button class="signout-btn" onclick="signOut()">Sign Out</button>
    </div>
  </header>

  <!-- Content -->
  <div id="content">

    <!-- â•â• PAGE: Dashboard â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-dashboard" class="page active">
      <div class="kpi-grid" id="kpiGrid">
        <!-- skeleton -->
        <div class="kpi-card"><div class="kpi-label"><span class="ki">ğŸ“¦</span> Total SKUs</div><div class="kpi-value blue skeleton" style="width:80px;height:32px">&nbsp;</div></div>
        <div class="kpi-card"><div class="kpi-label"><span class="ki">ğŸ’µ</span> Inventory Value</div><div class="kpi-value green skeleton" style="width:120px;height:32px">&nbsp;</div></div>
        <div class="kpi-card"><div class="kpi-label"><span class="ki">âš ï¸</span> Reorder Alerts</div><div class="kpi-value yellow skeleton" style="width:60px;height:32px">&nbsp;</div></div>
        <div class="kpi-card"><div class="kpi-label"><span class="ki">ğŸ­</span> Warehouses</div><div class="kpi-value skeleton" style="width:50px;height:32px">&nbsp;</div></div>
      </div>

      <div style="display:grid;grid-template-columns:2fr 1fr;gap:16px">
        <div class="card">
          <div class="card-header">
            <div class="card-title">ğŸ“‰ Stock Status Overview</div>
            <button class="btn btn-ghost btn-sm" onclick="showPage('stock')">View All â†’</button>
          </div>
          <div class="card-body" id="dashStockPreview">
            <div class="empty-state"><div class="empty-icon">â³</div><div class="empty-title">Loadingâ€¦</div></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">âš ï¸ Top Reorder Alerts</div></div>
          <div class="card-body" id="dashReorderPreview">
            <div class="empty-state"><div class="empty-icon">â³</div><div class="empty-title">Loadingâ€¦</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: Item Catalog â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-catalog" class="page">
      <div class="toolbar">
        <div class="search-wrap">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="catalogSearch" placeholder="Search by name, SKU, or UPCâ€¦" oninput="filterCatalog()"/>
        </div>
        <select class="filter-select" id="catalogCategoryFilter" onchange="filterCatalog()">
          <option value="">All Categories</option>
        </select>
        <select class="filter-select" id="catalogStatusFilter" onchange="filterCatalog()">
          <option value="">All Status</option>
          <option value="active">Active Only</option>
          <option value="inactive">Inactive</option>
        </select>
        <button class="btn btn-primary" onclick="openItemModal()">+ New Item</button>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Item Catalog</div>
          <span id="catalogCount" style="font-size:12px;color:var(--text2)"></span>
        </div>
        <div class="card-body">
          <div class="tbl-wrap">
            <table id="catalogTable">
              <thead>
                <tr>
                  <th data-sort="code" onclick="sortCatalog('code')">SKU</th>
                  <th data-sort="name" onclick="sortCatalog('name')">Name</th>
                  <th data-sort="category" onclick="sortCatalog('category')">Category</th>
                  <th>UOM</th>
                  <th data-sort="standard_cost" onclick="sortCatalog('standard_cost')" style="text-align:right">Cost</th>
                  <th data-sort="sale_price" onclick="sortCatalog('sale_price')" style="text-align:right">Sale Price</th>
                  <th>Reorder Pt.</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="catalogBody"></tbody>
            </table>
          </div>
          <div class="pagination" id="catalogPagination"></div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: Stock Overview â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-stock" class="page">
      <div class="toolbar">
        <div class="search-wrap">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="stockSearch" placeholder="Search itemsâ€¦" oninput="filterStock()"/>
        </div>
        <select class="filter-select" id="stockWarehouseFilter" onchange="filterStock()">
          <option value="">All Warehouses</option>
        </select>
        <select class="filter-select" id="stockStatusFilter" onchange="filterStock()">
          <option value="">All Stock Status</option>
          <option value="in_stock">In Stock</option>
          <option value="low_stock">Low Stock</option>
          <option value="out_of_stock">Out of Stock</option>
        </select>
        <button class="btn btn-ghost btn-sm" onclick="printStockReport()">ğŸ–¨ Print Report</button>
      </div>

      <div class="card" id="stockCard">
        <div class="card-header">
          <div class="card-title">Stock Overview</div>
          <span id="stockCount" style="font-size:12px;color:var(--text2)"></span>
        </div>
        <div class="card-body">
          <div class="tbl-wrap">
            <table id="stockTable">
              <thead>
                <tr>
                  <th>SKU</th>
                  <th>Item Name</th>
                  <th>Warehouse</th>
                  <th style="text-align:right">On Hand</th>
                  <th style="text-align:right">Reserved</th>
                  <th style="text-align:right">Available</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="stockBody"></tbody>
            </table>
          </div>
          <div class="pagination" id="stockPagination"></div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: Reorder Alerts â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-reorder" class="page">
      <div class="alert-bar alert-warning" style="margin-bottom:16px">
        âš ï¸ <span>Items below their reorder point need attention. Create a Purchase Order to replenish stock.</span>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Reorder Alerts</div>
          <span id="reorderCount" style="font-size:12px;color:var(--text2)"></span>
        </div>
        <div class="card-body">
          <div class="tbl-wrap">
            <table id="reorderTable">
              <thead>
                <tr>
                  <th>SKU</th>
                  <th>Item Name</th>
                  <th>Warehouses</th>
                  <th style="text-align:right">Total Stock</th>
                  <th style="text-align:right">Reorder Point</th>
                  <th style="text-align:right">Shortfall</th>
                  <th style="text-align:right">Suggested Order</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="reorderBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: Adjustments â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-adjustments" class="page">
      <div class="toolbar">
        <button class="btn btn-primary" onclick="openAdjModal()">+ New Adjustment</button>
        <select class="filter-select" id="adjStatusFilter" onchange="loadAdjustments()">
          <option value="">All Status</option>
          <option value="draft">Draft</option>
          <option value="posted">Posted</option>
        </select>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Stock Adjustments</div>
          <span id="adjCount" style="font-size:12px;color:var(--text2)"></span>
        </div>
        <div class="card-body">
          <div class="tbl-wrap">
            <table id="adjTable">
              <thead>
                <tr>
                  <th>Number</th>
                  <th>Date</th>
                  <th>Reason</th>
                  <th>Warehouse</th>
                  <th>Lines</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="adjBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->
</div><!-- /app -->

<!-- â”€â”€ Toast Container â”€â”€ -->
<div id="toast-container"></div>

<!-- â”€â”€ Item Modal â”€â”€ -->
<div class="modal-overlay" id="itemModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="itemModalTitle">New Item</div>
      <button class="modal-close" onclick="closeModal('itemModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="itemId"/>
      <div class="form-row">
        <div class="form-group">
          <label>SKU Code *</label>
          <input type="text" id="itemCode" placeholder="e.g. WATCH-001"/>
          <div class="field-error" id="errItemCode"></div>
        </div>
        <div class="form-group">
          <label>Item Name *</label>
          <input type="text" id="itemName" placeholder="e.g. Seiko NH35 Movement"/>
          <div class="field-error" id="errItemName"></div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Category</label>
          <input type="text" id="itemCategory" placeholder="e.g. Movements"/>
        </div>
        <div class="form-group">
          <label>Unit of Measure</label>
          <select id="itemUOM">
            <option value="EA">EA â€” Each</option>
            <option value="PR">PR â€” Pair</option>
            <option value="DZ">DZ â€” Dozen</option>
            <option value="BOX">BOX â€” Box</option>
            <option value="SET">SET â€” Set</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Standard Cost ($)</label>
          <input type="number" id="itemCost" placeholder="0.00" step="0.01" min="0"/>
        </div>
        <div class="form-group">
          <label>Sale Price ($)</label>
          <input type="number" id="itemSalePrice" placeholder="0.00" step="0.01" min="0"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Reorder Point</label>
          <input type="number" id="itemReorderPoint" placeholder="0" min="0"/>
        </div>
        <div class="form-group">
          <label>Reorder Qty</label>
          <input type="number" id="itemReorderQty" placeholder="0" min="0"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>UPC / Barcode</label>
          <input type="text" id="itemUPC" placeholder="Optional barcode"/>
        </div>
        <div class="form-group">
          <label>Lead Time (Days)</label>
          <input type="number" id="itemLeadTime" placeholder="0" min="0"/>
        </div>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="itemDescription" placeholder="Optional item descriptionâ€¦"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('itemModal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveItem()" id="itemSaveBtn">Save Item</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Adjustment Modal â”€â”€ -->
<div class="modal-overlay" id="adjModal">
  <div class="modal" style="max-width:680px">
    <div class="modal-header">
      <div class="modal-title">New Stock Adjustment</div>
      <button class="modal-close" onclick="closeModal('adjModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Reason *</label>
          <select id="adjReason">
            <option value="">Select reasonâ€¦</option>
            <option value="Cycle Count">Cycle Count</option>
            <option value="Damaged Goods">Damaged Goods</option>
            <option value="Receiving Variance">Receiving Variance</option>
            <option value="Theft/Shrinkage">Theft / Shrinkage</option>
            <option value="Return to Vendor">Return to Vendor</option>
            <option value="Opening Balance">Opening Balance</option>
          </select>
          <div class="field-error" id="errAdjReason"></div>
        </div>
        <div class="form-group">
          <label>Warehouse *</label>
          <select id="adjWarehouse">
            <option value="">Select warehouseâ€¦</option>
          </select>
          <div class="field-error" id="errAdjWarehouse"></div>
        </div>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" id="adjNotes" placeholder="Optional notesâ€¦"/>
      </div>

      <div style="margin-top:4px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between">
        <div style="font-size:12px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.06em">Line Items</div>
        <button class="btn btn-ghost btn-sm" onclick="addAdjLine()">+ Add Line</button>
      </div>
      <div id="adjLines"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('adjModal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveAdjustment()" id="adjSaveBtn">Save Draft</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Quick Create PO Modal â”€â”€ -->
<div class="modal-overlay" id="quickPOModal">
  <div class="modal" style="max-width:520px">
    <div class="modal-header">
      <div class="modal-title">Create Purchase Order</div>
      <button class="modal-close" onclick="closeModal('quickPOModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="alert-bar alert-info" style="margin-bottom:16px">
        â„¹ï¸ <span>This creates a draft PO. Go to <a href="/purchasing" style="color:var(--blue);font-weight:600">Purchasing</a> to send it to your vendor and track receiving.</span>
      </div>
      <div id="quickPOItemSummary" style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;margin-bottom:16px;font-size:13px"></div>
      <div class="form-row">
        <div class="form-group">
          <label>Vendor *</label>
          <select id="quickPOVendor">
            <option value="">Select vendorâ€¦</option>
          </select>
          <div class="field-error" id="errQuickPOVendor"></div>
        </div>
        <div class="form-group">
          <label>Warehouse *</label>
          <select id="quickPOWarehouse">
            <option value="">Select warehouseâ€¦</option>
          </select>
          <div class="field-error" id="errQuickPOWarehouse"></div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Order Qty</label>
          <input type="number" id="quickPOQty" min="1" step="1"/>
        </div>
        <div class="form-group">
          <label>Expected Delivery</label>
          <input type="date" id="quickPODate"/>
        </div>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" id="quickPONotes" placeholder="Optional notes to vendorâ€¦"/>
      </div>
      <input type="hidden" id="quickPOItemId"/>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('quickPOModal')">Cancel</button>
      <button class="btn btn-primary" onclick="submitQuickPO()" id="quickPOBtn">Create Draft PO</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Movement History Modal â”€â”€ -->
<div class="modal-overlay" id="historyModal">
  <div class="modal" style="max-width:600px">
    <div class="modal-header">
      <div class="modal-title" id="historyModalTitle">Movement History</div>
      <button class="modal-close" onclick="closeModal('historyModal')">âœ•</button>
    </div>
    <div class="modal-body" id="historyBody">
      <div class="empty-state"><div class="empty-icon">â³</div><div class="empty-title">Loadingâ€¦</div></div>
    </div>
  </div>
</div>

<script>
'use strict';

// â”€â”€ Auth Guard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TOKEN_KEY = 'tt_token';
const USER_KEY  = 'tt_user';
const API       = '';

function getToken() { return localStorage.getItem(TOKEN_KEY); }
function getUser()  {
  try { return JSON.parse(localStorage.getItem(USER_KEY) || '{}'); }
  catch { return {}; }
}
function signOut() {
  localStorage.removeItem(TOKEN_KEY);
  localStorage.removeItem(USER_KEY);
  window.location.href = '/login.html';
}
function isTokenValid(token) {
  if (!token) return false;
  try {
    const p = JSON.parse(atob(token.split('.')[1]));
    return p.exp * 1000 > Date.now();
  } catch { return false; }
}
(function authGuard() {
  const token = getToken();
  if (!isTokenValid(token)) {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(USER_KEY);
    window.location.href = '/login.html';
  }
})();

// â”€â”€ Fetch with Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function apiFetch(url, options = {}) {
  const token = getToken();
  const headers = { 'Content-Type': 'application/json', ...(options.headers || {}) };
  if (token) headers['Authorization'] = `Bearer ${token}`;
  const res = await fetch(API + url, { ...options, headers });
  if (res.status === 401) { signOut(); return; }
  return res;
}

// â”€â”€ Toast System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(type, title, msg, duration = 4000) {
  const icons = { success:'âœ…', error:'âŒ', warning:'âš ï¸', info:'â„¹ï¸' };
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.innerHTML = `
    <span class="toast-icon">${icons[type] || 'â„¹ï¸'}</span>
    <div class="toast-body">
      <div class="toast-title">${title}</div>
      ${msg ? `<div class="toast-msg">${msg}</div>` : ''}
    </div>
    <button class="toast-close" onclick="this.closest('.toast').remove()">âœ•</button>
  `;
  c.appendChild(t);
  setTimeout(() => {
    t.style.animation = 'slideOut .25s ease forwards';
    setTimeout(() => t.remove(), 250);
  }, duration);
}

// â”€â”€ Modal Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id)  { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.addEventListener('click', e => {
  if (e.target.classList.contains('modal-overlay')) {
    e.target.classList.remove('open');
  }
});

// â”€â”€ Format Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmtDate(d)   { if (!d) return 'â€”'; const dt = new Date(d); return `${dt.getMonth()+1}/${dt.getDate()}/${dt.getFullYear()}`; }
function fmtMoney(n)  { return '$' + parseFloat(n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function fmtNum(n)    { return parseFloat(n||0).toLocaleString('en-US',{maximumFractionDigits:2}); }
function fmtInitials(name) {
  return (name || '?').split(' ').map(w=>w[0]).slice(0,2).join('').toUpperCase();
}
function avatarColor(role) {
  return { admin:'#b45309', warehouse:'#047857', sales:'#1d4ed8' }[role] || '#374151';
}

// â”€â”€ Stock Status Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function stockBadge(available, reorderPoint) {
  if (available <= 0)            return '<span class="badge badge-red">Out of Stock</span>';
  if (available <= reorderPoint) return '<span class="badge badge-yellow">Low Stock</span>';
  return '<span class="badge badge-green">In Stock</span>';
}

// â”€â”€ Page Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PAGE_TITLES = {
  dashboard:   'Dashboard',
  catalog:     'Item Catalog',
  stock:       'Stock Overview',
  reorder:     'Reorder Alerts',
  adjustments: 'Adjustments',
};
const PAGE_LOADERS = {
  dashboard:   loadDashboard,
  catalog:     loadCatalog,
  stock:       loadStock,
  reorder:     loadReorderAlerts,
  adjustments: loadAdjustments,
};
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const pg = document.getElementById(`page-${id}`);
  if (pg) pg.classList.add('active');
  const btns = document.querySelectorAll(`.nav-item`);
  btns.forEach(b => { if (b.textContent.toLowerCase().includes(PAGE_TITLES[id]?.split(' ')[0]?.toLowerCase())) b.classList.add('active'); });
  document.getElementById('headerTitle').textContent = PAGE_TITLES[id] || '';
  if (PAGE_LOADERS[id]) PAGE_LOADERS[id]();
}

// â”€â”€ Skeleton Rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function skeletonRows(cols, n = 5) {
  return Array.from({length:n}, () => `
    <tr class="skel-row">${Array.from({length:cols}, () => `<td><div class="skeleton skel-cell" style="width:${60+Math.random()*80}%">&nbsp;</div></td>`).join('')}</tr>
  `).join('');
}

// â”€â”€ Pagination Helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPagination(containerId, current, total, perPage, onPage) {
  const pages = Math.ceil(total / perPage);
  const el = document.getElementById(containerId);
  if (!el) return;
  const from = Math.min((current-1)*perPage+1, total);
  const to   = Math.min(current*perPage, total);
  el.innerHTML = `
    <span>Showing ${from}â€“${to} of ${total} records</span>
    <div class="page-btns">
      <button class="page-btn" ${current<=1?'disabled':''} onclick="(${onPage})(${current-1})">â€¹</button>
      ${Array.from({length:Math.min(pages,7)}, (_,i) => {
        const p = i+1;
        return `<button class="page-btn ${p===current?'active':''}" onclick="(${onPage})(${p})">${p}</button>`;
      }).join('')}
      <button class="page-btn" ${current>=pages?'disabled':''} onclick="(${onPage})(${current+1})">â€º</button>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  initUserHeader();
  loadHealthInfo();
  loadDashboard();
  loadReorderBadge();
  loadWarehouseFilters();
  prefetchItems();   // always load items so the adjustment dropdown is ready
});

// Prefetch items silently so dropdowns are always ready
async function prefetchItems() {
  if (allItems.length > 0) return;
  try {
    const res = await apiFetch('/api/items');
    if (!res) return;
    const data = await res.json();
    allItems = Array.isArray(data) ? data : (data.data || []);
  } catch {}
}

function initUserHeader() {
  const user = getUser();
  document.getElementById('userName').textContent   = user.name || 'User';
  document.getElementById('userAvatar').textContent = fmtInitials(user.name);
  document.getElementById('userAvatar').style.background = avatarColor(user.role);
  const badge = document.getElementById('userRoleBadge');
  badge.textContent  = user.role || '';
  badge.className    = `role-badge role-${user.role}`;
}

async function loadHealthInfo() {
  try {
    const res = await apiFetch('/api/health');
    if (!res) return;
    const { data } = await res.json();
    document.getElementById('versionFooter').textContent = `v${data.version}`;
    document.getElementById('uptimeDisplay').textContent  = `â†‘ ${Math.floor(data.uptime/60)}m`;
    const titleEl = document.querySelector('.sidebar-logo-text .sub');
    if (titleEl) titleEl.textContent = `ERP v${data.version}`;
  } catch {}
}

async function loadWarehouseFilters() {
  try {
    const res = await apiFetch('/api/warehouses');
    if (!res) return;
    const data = await res.json();
    const whs = Array.isArray(data) ? data : (data.data || []);
    const opts = whs.map(w => `<option value="${w.id}">${w.name}</option>`).join('');
    document.getElementById('stockWarehouseFilter').innerHTML += opts;
    // adj modal
    const adjSel = document.getElementById('adjWarehouse');
    if (adjSel) adjSel.innerHTML = `<option value="">Select warehouseâ€¦</option>` + opts;
  } catch {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDashboard() {
  loadKPIs();
  loadDashStockPreview();
  loadDashReorderPreview();
}

async function loadKPIs() {
  try {
    const res = await apiFetch('/api/dashboard/stats');
    if (!res) return;
    const { data } = await res.json();
    document.getElementById('kpiGrid').innerHTML = `
      <div class="kpi-card">
        <div class="kpi-label"><span class="ki">ğŸ“¦</span> Total SKUs</div>
        <div class="kpi-value blue">${data.total_items}</div>
        <div class="kpi-sub">${data.low_stock_count} low, ${data.out_of_stock_count} out of stock</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label"><span class="ki">ğŸ’µ</span> Inventory Value</div>
        <div class="kpi-value green">${fmtMoney(data.total_inventory_value)}</div>
        <div class="kpi-sub">Based on standard cost</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label"><span class="ki">âš ï¸</span> Reorder Alerts</div>
        <div class="kpi-value ${data.reorder_alert_count > 0 ? 'yellow' : 'green'}">${data.reorder_alert_count}</div>
        <div class="kpi-sub">${data.reorder_alert_count > 0 ? 'Items need replenishment' : 'All stock levels OK'}</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label"><span class="ki">ğŸ­</span> Active Warehouses</div>
        <div class="kpi-value">${data.warehouse_count}</div>
        <div class="kpi-sub">Storage locations</div>
      </div>
    `;
    // Update nav badge
    const cnt = data.reorder_alert_count || 0;
    const badge = document.getElementById('reorderNavBadge');
    const dot   = document.getElementById('notifDot');
    if (cnt > 0) {
      badge.textContent = cnt; badge.style.display = '';
      dot.style.display = '';
    } else {
      badge.style.display = 'none';
      dot.style.display   = 'none';
    }
  } catch(e) {
    console.error('KPI error:', e);
  }
}

async function loadDashStockPreview() {
  const el = document.getElementById('dashStockPreview');
  try {
    const res = await apiFetch('/api/stock');
    if (!res) return;
    const data = await res.json();
    const rows = Array.isArray(data) ? data : (data.data || []);
    if (!rows.length) {
      el.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“¦</div><div class="empty-title">No stock data</div></div>`;
      return;
    }
    const top = rows.slice(0, 6);
    el.innerHTML = `
      <table style="width:100%">
        <thead><tr>
          <th style="padding:10px 14px;font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;background:var(--bg);border-bottom:1px solid var(--border)">Item</th>
          <th style="padding:10px 14px;font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;background:var(--bg);border-bottom:1px solid var(--border);text-align:right">Available</th>
          <th style="padding:10px 14px;font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;background:var(--bg);border-bottom:1px solid var(--border)">Status</th>
        </tr></thead>
        <tbody>
          ${top.map(r => `<tr style="border-bottom:1px solid var(--border)">
            <td style="padding:10px 14px">
              <div style="font-weight:600;color:var(--text0)">${r.item_name||r.name||''}</div>
              <div style="font-size:11px;color:var(--text2)">${r.item_code||r.code||''}</div>
            </td>
            <td style="padding:10px 14px;text-align:right;font-weight:700">${fmtNum(r.qty_available??r.available??r.qty_on_hand??0)}</td>
            <td style="padding:10px 14px">${stockBadge(r.qty_available??r.available??r.qty_on_hand??1, r.reorder_point??0)}</td>
          </tr>`).join('')}
        </tbody>
      </table>
    `;
  } catch(e) {
    el.innerHTML = `<div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load</div></div>`;
  }
}

async function loadDashReorderPreview() {
  const el = document.getElementById('dashReorderPreview');
  try {
    const res = await apiFetch('/api/stock/reorder-alerts');
    if (!res) return;
    const data = await res.json();
    const rows = Array.isArray(data) ? data : (data.data || []);
    if (!rows.length) {
      el.innerHTML = `<div class="empty-state"><div class="empty-icon">âœ…</div><div class="empty-title">All stocked up</div><div class="empty-sub">No items below reorder point</div></div>`;
      return;
    }
    el.innerHTML = rows.slice(0,8).map(r => `
      <div style="padding:11px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px">
        <span style="font-size:16px">âš ï¸</span>
        <div style="flex:1">
          <div style="font-weight:600;font-size:12px;color:var(--text0)">${r.item_name||r.name||''}</div>
          <div style="font-size:11px;color:var(--text2)">${r.item_code||r.code||''} Â· ${r.warehouse_name||''}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700;color:var(--red)">${fmtNum(r.qty_available??r.available??r.qty_on_hand??0)}</div>
          <div style="font-size:10px;color:var(--text2)">/ ${fmtNum(r.reorder_point)} min</div>
        </div>
      </div>
    `).join('');
  } catch(e) {
    el.innerHTML = `<div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load</div></div>`;
  }
}

async function loadReorderBadge() {
  try {
    const res = await apiFetch('/api/stock/reorder-alerts');
    if (!res) return;
    const data = await res.json();
    const rows = Array.isArray(data) ? data : (data.data || []);
    const cnt = rows.length;
    const badge = document.getElementById('reorderNavBadge');
    const dot   = document.getElementById('notifDot');
    const banner = document.getElementById('reorderBanner');
    if (cnt > 0) {
      badge.textContent = cnt; badge.style.display = '';
      dot.style.display = '';
      if (banner) { banner.classList.remove('hidden'); banner.querySelector('.banner-title').textContent = `${cnt} items below reorder point`; }
    }
  } catch {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ITEM CATALOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let allItems = [], filteredItems = [], catalogPage = 1;
const CATALOG_PER_PAGE = 25;
let catalogSortCol = 'name', catalogSortDir = 'asc';

async function loadCatalog() {
  const body = document.getElementById('catalogBody');
  body.innerHTML = skeletonRows(9);
  try {
    const res = await apiFetch('/api/items');
    if (!res) return;
    const data = await res.json();
    allItems = Array.isArray(data) ? data : (data.data || []);
    // Build category filter
    const cats = [...new Set(allItems.map(i => i.category).filter(Boolean))].sort();
    const catSel = document.getElementById('catalogCategoryFilter');
    catSel.innerHTML = `<option value="">All Categories</option>` + cats.map(c => `<option value="${c}">${c}</option>`).join('');
    filterCatalog();
  } catch(e) {
    body.innerHTML = `<tr><td colspan="9"><div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load items</div></div></td></tr>`;
    toast('error', 'Load Failed', e.message);
  }
}

function filterCatalog() {
  const q      = document.getElementById('catalogSearch').value.toLowerCase();
  const cat    = document.getElementById('catalogCategoryFilter').value;
  const status = document.getElementById('catalogStatusFilter').value;
  filteredItems = allItems.filter(i => {
    if (q && !( (i.code||'').toLowerCase().includes(q) || (i.name||'').toLowerCase().includes(q) || (i.upc_code||'').toLowerCase().includes(q) )) return false;
    if (cat && i.category !== cat) return false;
    if (status === 'active'   && !i.is_active) return false;
    if (status === 'inactive' &&  i.is_active) return false;
    return true;
  });
  sortCatalogData();
  catalogPage = 1;
  renderCatalog();
}

function sortCatalog(col) {
  if (catalogSortCol === col) catalogSortDir = catalogSortDir === 'asc' ? 'desc' : 'asc';
  else { catalogSortCol = col; catalogSortDir = 'asc'; }
  document.querySelectorAll('#catalogTable thead th').forEach(th => { th.classList.remove('sort-asc','sort-desc'); });
  const th = document.querySelector(`#catalogTable thead th[data-sort="${col}"]`);
  if (th) th.classList.add(`sort-${catalogSortDir}`);
  sortCatalogData();
  renderCatalog();
}
function sortCatalogData() {
  const dir = catalogSortDir === 'asc' ? 1 : -1;
  filteredItems.sort((a,b) => {
    const av = a[catalogSortCol] ?? '', bv = b[catalogSortCol] ?? '';
    if (typeof av === 'number') return (av - bv) * dir;
    return String(av).localeCompare(String(bv)) * dir;
  });
}

function renderCatalog() {
  const body   = document.getElementById('catalogBody');
  const total  = filteredItems.length;
  const page   = catalogPage;
  const start  = (page-1) * CATALOG_PER_PAGE;
  const items  = filteredItems.slice(start, start + CATALOG_PER_PAGE);
  document.getElementById('catalogCount').textContent = `${total} items`;

  if (!items.length) {
    body.innerHTML = `<tr><td colspan="9"><div class="empty-state">
      <div class="empty-icon">ğŸ“¦</div>
      <div class="empty-title">No items found</div>
      <div class="empty-sub">Try adjusting your search or filters, or add a new item.</div>
    </div></td></tr>`;
    document.getElementById('catalogPagination').innerHTML = '';
    return;
  }

  body.innerHTML = items.map(i => `
    <tr>
      <td><div class="cell-main">${i.code}</div>${i.upc_code ? `<div class="cell-sub">UPC: ${i.upc_code}</div>` : ''}</td>
      <td><div class="cell-main">${i.name}</div>${i.description?`<div class="cell-sub" style="max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${i.description}</div>`:''}</td>
      <td>${i.category ? `<span class="badge badge-gray">${i.category}</span>` : 'â€”'}</td>
      <td>${i.unit_of_measure || 'EA'}</td>
      <td style="text-align:right;font-weight:600">${fmtMoney(i.standard_cost)}</td>
      <td style="text-align:right;font-weight:600">${fmtMoney(i.sale_price)}</td>
      <td style="text-align:right">${fmtNum(i.reorder_point)}</td>
      <td>${i.is_active ? '<span class="badge badge-green">Active</span>' : '<span class="badge badge-gray">Inactive</span>'}</td>
      <td>
        <div style="display:flex;gap:4px">
          <button class="btn btn-ghost btn-sm btn-icon" onclick="editItem('${i.id}')" title="Edit">âœï¸</button>
          <button class="btn btn-danger btn-sm btn-icon" onclick="deleteItem('${i.id}','${i.name.replace(/'/g,"\\'")}',this)" title="Delete">ğŸ—‘</button>
        </div>
      </td>
    </tr>
  `).join('');

  buildPagination('catalogPagination', page, total, CATALOG_PER_PAGE,
    `function(p){catalogPage=p;renderCatalog()}`);
}

// â”€â”€ Item Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openItemModal(data = null) {
  document.getElementById('itemModalTitle').textContent = data ? 'Edit Item' : 'New Item';
  document.getElementById('itemId').value           = data?.id || '';
  document.getElementById('itemCode').value         = data?.code || '';
  document.getElementById('itemName').value         = data?.name || '';
  document.getElementById('itemCategory').value     = data?.category || '';
  document.getElementById('itemUOM').value          = data?.unit_of_measure || 'EA';
  document.getElementById('itemCost').value         = data?.standard_cost || '';
  document.getElementById('itemSalePrice').value    = data?.sale_price || '';
  document.getElementById('itemReorderPoint').value = data?.reorder_point || '';
  document.getElementById('itemReorderQty').value   = data?.reorder_qty || '';
  document.getElementById('itemUPC').value          = data?.upc_code || '';
  document.getElementById('itemLeadTime').value     = data?.lead_time_days || '';
  document.getElementById('itemDescription').value  = data?.description || '';
  ['itemCode','itemName'].forEach(id => {
    document.getElementById(id).classList.remove('error');
  });
  document.getElementById('errItemCode').textContent = '';
  document.getElementById('errItemName').textContent = '';
  openModal('itemModal');
}

async function editItem(id) {
  try {
    const res = await apiFetch(`/api/items/${id}`);
    if (!res) return;
    const data = await res.json();
    openItemModal(Array.isArray(data) ? data[0] : (data.data || data));
  } catch(e) { toast('error', 'Error', e.message); }
}

async function saveItem() {
  const id = document.getElementById('itemId').value;
  const code = document.getElementById('itemCode').value.trim();
  const name = document.getElementById('itemName').value.trim();
  let valid = true;

  if (!code) { document.getElementById('itemCode').classList.add('error'); document.getElementById('errItemCode').textContent = 'SKU code is required'; valid=false; }
  else        { document.getElementById('itemCode').classList.remove('error'); document.getElementById('errItemCode').textContent=''; }
  if (!name) { document.getElementById('itemName').classList.add('error'); document.getElementById('errItemName').textContent = 'Item name is required'; valid=false; }
  else        { document.getElementById('itemName').classList.remove('error'); document.getElementById('errItemName').textContent=''; }
  if (!valid) return;

  const payload = {
    code, name,
    category:        document.getElementById('itemCategory').value.trim() || null,
    unit_of_measure: document.getElementById('itemUOM').value,
    standard_cost:   parseFloat(document.getElementById('itemCost').value) || 0,
    sale_price:      parseFloat(document.getElementById('itemSalePrice').value) || 0,
    reorder_point:   parseFloat(document.getElementById('itemReorderPoint').value) || 0,
    reorder_qty:     parseFloat(document.getElementById('itemReorderQty').value) || 0,
    lead_time_days:  parseInt(document.getElementById('itemLeadTime').value) || 0,
    upc_code:        document.getElementById('itemUPC').value.trim() || null,
    description:     document.getElementById('itemDescription').value.trim() || null,
  };

  const btn = document.getElementById('itemSaveBtn');
  btn.disabled = true; btn.textContent = 'Savingâ€¦';

  try {
    const method = id ? 'PATCH' : 'POST';
    const url    = id ? `/api/items/${id}` : '/api/items';
    const res    = await apiFetch(url, { method, body: JSON.stringify(payload) });
    const body   = await res.json();
    if (!res.ok) throw new Error(body.error || 'Failed to save');
    closeModal('itemModal');
    toast('success', id ? 'Item Updated' : 'Item Created', name);
    loadCatalog();
  } catch(e) {
    toast('error', 'Save Failed', e.message);
  } finally {
    btn.disabled = false; btn.textContent = 'Save Item';
  }
}

async function deleteItem(id, name, btnEl) {
  if (!confirm(`Delete "${name}"?\n\nThis cannot be undone if stock exists.`)) return;
  try {
    const res = await apiFetch(`/api/items/${id}`, { method: 'DELETE' });
    if (res && res.ok) {
      toast('success', 'Item Deleted', name);
      loadCatalog();
    } else {
      const body = await res?.json();
      toast('error', 'Delete Failed', body?.error || 'Could not delete item');
    }
  } catch(e) { toast('error', 'Error', e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STOCK OVERVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let allStock = [], filteredStock = [], stockPage = 1;
const STOCK_PER_PAGE = 25;

async function loadStock() {
  const body = document.getElementById('stockBody');
  body.innerHTML = skeletonRows(8);
  try {
    const res = await apiFetch('/api/stock');
    if (!res) return;
    const data = await res.json();
    allStock = Array.isArray(data) ? data : (data.data || []);
    filterStock();
  } catch(e) {
    body.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load stock</div></div></td></tr>`;
    toast('error', 'Load Failed', e.message);
  }
}

function filterStock() {
  const q    = (document.getElementById('stockSearch')?.value || '').toLowerCase();
  const wh   = document.getElementById('stockWarehouseFilter')?.value;
  const stat = document.getElementById('stockStatusFilter')?.value;
  filteredStock = allStock.filter(r => {
    const avail = parseFloat(r.qty_available ?? r.available ?? r.qty_on_hand ?? 0);
    const rp    = parseFloat(r.reorder_point ?? 0);
    if (q && !( (r.item_name||r.name||'').toLowerCase().includes(q) || (r.item_code||r.code||'').toLowerCase().includes(q) )) return false;
    if (wh && r.warehouse_id !== wh) return false;
    if (stat === 'in_stock'    && !(avail > rp)) return false;
    if (stat === 'low_stock'   && !(avail > 0 && avail <= rp)) return false;
    if (stat === 'out_of_stock'&& avail > 0) return false;
    return true;
  });
  stockPage = 1;
  renderStock();
}

function renderStock() {
  const body  = document.getElementById('stockBody');
  const total = filteredStock.length;
  const start = (stockPage-1) * STOCK_PER_PAGE;
  const rows  = filteredStock.slice(start, start + STOCK_PER_PAGE);
  document.getElementById('stockCount').textContent = `${total} records`;

  if (!rows.length) {
    body.innerHTML = `<tr><td colspan="8"><div class="empty-state">
      <div class="empty-icon">ğŸ­</div>
      <div class="empty-title">No stock records</div>
      <div class="empty-sub">Add items and record receipts to see stock here.</div>
    </div></td></tr>`;
    document.getElementById('stockPagination').innerHTML = '';
    return;
  }

  body.innerHTML = rows.map(r => {
    const avail = parseFloat(r.qty_available ?? r.available ?? r.qty_on_hand ?? 0);
    const rp    = parseFloat(r.reorder_point ?? 0);
    return `<tr>
      <td><div class="cell-main">${r.item_code||r.code||''}</div></td>
      <td><div class="cell-main">${r.item_name||r.name||''}</div></td>
      <td>${r.warehouse_name||'â€”'}</td>
      <td style="text-align:right;font-weight:600">${fmtNum(r.qty_on_hand??0)}</td>
      <td style="text-align:right;color:var(--text2)">${fmtNum(r.qty_committed??r.qty_reserved??0)}</td>
      <td style="text-align:right;font-weight:700">${fmtNum(avail)}</td>
      <td>${stockBadge(avail, rp)}</td>
      <td>
        <button class="btn btn-ghost btn-sm" onclick="showHistory('${r.item_id||r.id}','${(r.item_name||r.name||'').replace(/'/g,"\\'")}')">ğŸ“œ History</button>
      </td>
    </tr>`;
  }).join('');

  buildPagination('stockPagination', stockPage, total, STOCK_PER_PAGE,
    `function(p){stockPage=p;renderStock()}`);
}

async function showHistory(itemId, itemName) {
  document.getElementById('historyModalTitle').textContent = `Movement History â€” ${itemName}`;
  document.getElementById('historyBody').innerHTML = `<div class="empty-state"><div class="empty-icon">â³</div><div class="empty-title">Loadingâ€¦</div></div>`;
  openModal('historyModal');
  try {
    const res = await apiFetch(`/api/stock/${itemId}/history`);
    if (!res) return;
    const data = await res.json();
    const rows = Array.isArray(data) ? data : (data.data || []);
    if (!rows.length) {
      document.getElementById('historyBody').innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div class="empty-title">No movements yet</div></div>`;
      return;
    }
    document.getElementById('historyBody').innerHTML = rows.map(r => {
      const qty = parseFloat(r.qty);
      const isPos = qty >= 0;
      const typeColors = { receipt:'#10b981', shipment:'#ef4444', adjustment:'#f59e0b', opening_balance:'#2563eb', transfer_in:'#8b5cf6', transfer_out:'#f97316' };
      const col = typeColors[r.transaction_type] || '#64748b';
      return `<div class="history-row">
        <div class="history-badge" style="background:${col}"></div>
        <div class="history-info">
          <div style="font-size:12px;font-weight:600;color:var(--text0)">${(r.transaction_type||'').replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase())}</div>
          <div style="font-size:11px;color:var(--text2)">${r.warehouse_name||''} Â· ${fmtDate(r.posting_date||r.created_at)} Â· ${r.notes||r.reference_type||''}</div>
        </div>
        <div class="history-qty ${isPos?'pos':'neg'}">${isPos?'+':''}${fmtNum(qty)} ${r.unit_of_measure||''}</div>
      </div>`;
    }).join('');
  } catch(e) {
    document.getElementById('historyBody').innerHTML = `<div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load</div></div>`;
  }
}

function printStockReport() {
  window.print();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REORDER ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadReorderAlerts() {
  const body = document.getElementById('reorderBody');
  body.innerHTML = skeletonRows(7);
  try {
    const res = await apiFetch('/api/stock/reorder-alerts');
    if (!res) return;
    const data = await res.json();
    const rows = Array.isArray(data) ? data : (data.data || []);
    document.getElementById('reorderCount').textContent = `${rows.length} items`;

    if (!rows.length) {
      body.innerHTML = `<tr><td colspan="8"><div class="empty-state">
        <div class="empty-icon">âœ…</div>
        <div class="empty-title">All stocked up!</div>
        <div class="empty-sub">No items are below their reorder point. Great work!</div>
      </div></td></tr>`;
      return;
    }

    body.innerHTML = rows.map(r => {
      const avail    = parseFloat(r.qty_available ?? 0);
      const rp       = parseFloat(r.reorder_point ?? 0);
      const shortfall = parseFloat(r.shortfall ?? Math.max(rp - avail, 0));
      const sugg     = parseFloat(r.reorder_qty   ?? shortfall) || shortfall;
      const isOut    = avail <= 0;
      return `<tr>
        <td><div class="cell-main">${r.item_code||r.code||''}</div></td>
        <td>
          <div class="cell-main">${r.item_name||r.name||''}</div>
          <div class="cell-sub">${r.category||''}</div>
        </td>
        <td style="font-size:11px;color:var(--text2)">${r.warehouse_names||'All warehouses'}</td>
        <td style="text-align:right;color:${isOut?'var(--red)':'var(--yellow)'};font-weight:700">${fmtNum(avail)}</td>
        <td style="text-align:right">${fmtNum(rp)}</td>
        <td style="text-align:right;color:var(--red);font-weight:700">${fmtNum(shortfall)}</td>
        <td style="text-align:right;color:var(--blue);font-weight:600">${fmtNum(sugg)}</td>
        <td>
          <button class="btn btn-primary btn-sm"
            onclick="openQuickPO('${r.item_id}','${(r.item_name||'').replace(/'/g,"\\'")}','${r.item_code||''}',${shortfall},${sugg})">
            ğŸ“‹ Create PO
          </button>
        </td>
      </tr>`;
    }).join('');
  } catch(e) {
    body.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load</div></div></td></tr>`;
    toast('error', 'Load Failed', e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADJUSTMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let adjLineCount = 0;

async function loadAdjustments() {
  const body = document.getElementById('adjBody');
  body.innerHTML = skeletonRows(7);
  const status = document.getElementById('adjStatusFilter')?.value;
  try {
    const url = status ? `/api/adjustments?status=${status}` : '/api/adjustments';
    const res = await apiFetch(url);
    if (!res) return;
    const data = await res.json();
    const rows = Array.isArray(data) ? data : (data.data || []);
    document.getElementById('adjCount').textContent = `${rows.length} adjustments`;

    if (!rows.length) {
      body.innerHTML = `<tr><td colspan="7"><div class="empty-state">
        <div class="empty-icon">ğŸ“</div>
        <div class="empty-title">No adjustments</div>
        <div class="empty-sub">Create a stock adjustment for cycle counts, damaged goods, or corrections.</div>
      </div></td></tr>`;
      return;
    }

    body.innerHTML = rows.map(r => `
      <tr>
        <td><div class="cell-main">${r.number||'â€”'}</div></td>
        <td>${fmtDate(r.adj_date||r.created_at)}</td>
        <td>${r.reason||'â€”'}</td>
        <td>${r.warehouse_name||'â€”'}</td>
        <td>${r.line_count||'â€”'}</td>
        <td>${r.status === 'posted'
          ? '<span class="badge badge-green">Posted</span>'
          : '<span class="badge badge-yellow">Draft</span>'}</td>
        <td>
          <div style="display:flex;gap:4px">
            ${r.status !== 'posted' ? `
              <button class="btn btn-success btn-sm" onclick="postAdjustment('${r.id}',this)">Post</button>
              <button class="btn btn-danger btn-sm" onclick="deleteAdjustment('${r.id}',this)">Delete</button>
            ` : '<span style="color:var(--text3);font-size:11px">Completed</span>'}
          </div>
        </td>
      </tr>
    `).join('');
  } catch(e) {
    body.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">âš ï¸</div><div class="empty-title">Failed to load</div></div></td></tr>`;
    toast('error', 'Load Failed', e.message);
  }
}

async function openAdjModal() {
  document.getElementById('adjReason').value    = '';
  document.getElementById('adjWarehouse').value = '';
  document.getElementById('adjNotes').value     = '';
  document.getElementById('adjLines').innerHTML = '';
  adjLineCount = 0;
  // Ensure items are loaded before opening
  if (allItems.length === 0) await prefetchItems();
  addAdjLine();
  openModal('adjModal');
}

async function addAdjLine() {
  // If still no items, fetch now
  if (allItems.length === 0) await prefetchItems();

  adjLineCount++;
  const id = `line_${adjLineCount}`;
  const div = document.createElement('div');
  div.id = id;
  div.style.cssText = 'margin-bottom:8px;padding:10px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm)';

  // Build searchable item list with a text input + datalist
  const opts = allItems
    .filter(i => i.is_active)
    .sort((a,b) => (a.code||'').localeCompare(b.code||''))
    .map(i => `<option value="${i.code} â€” ${i.name}" data-id="${i.id}" data-cost="${i.standard_cost}"></option>`)
    .join('');

  div.innerHTML = `
    <div style="display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:8px;align-items:end">
      <div class="form-group" style="margin:0">
        <label>Item * <span style="font-weight:400;color:var(--text3)">(type to search)</span></label>
        <input type="text" class="adj-item-input" list="itemList_${id}"
          placeholder="Search by SKU or nameâ€¦"
          oninput="onAdjItemInput(this,'${id}')"
          autocomplete="off"/>
        <datalist id="itemList_${id}">${opts}</datalist>
        <input type="hidden" class="adj-item-id" data-lineid="${id}"/>
      </div>
      <div class="form-group" style="margin:0">
        <label>Qty Change (Â±)</label>
        <input type="number" class="adj-qty" step="0.01" placeholder="+10 or -5"/>
      </div>
      <div class="form-group" style="margin:0">
        <label>Unit Cost ($)</label>
        <input type="number" class="adj-cost" step="0.01" placeholder="0.00" min="0"/>
      </div>
      <button class="btn btn-danger btn-sm btn-icon" style="margin-bottom:0" onclick="document.getElementById('${id}').remove()" title="Remove line">âœ•</button>
    </div>
    <div style="font-size:11px;color:var(--text3);margin-top:4px" id="adjLineHint_${id}"></div>
  `;
  document.getElementById('adjLines').appendChild(div);
}

function onAdjItemInput(inputEl, lineId) {
  const val = inputEl.value;
  const list = document.getElementById(`itemList_${lineId}`);
  const row  = document.getElementById(lineId);
  if (!list || !row) return;

  // Find the matching option
  const matched = Array.from(list.options).find(o => o.value === val);
  const hiddenId = row.querySelector('.adj-item-id');
  const costEl   = row.querySelector('.adj-cost');
  const hintEl   = document.getElementById(`adjLineHint_${lineId}`);

  if (matched) {
    const itemId = matched.dataset.id;
    const cost   = parseFloat(matched.dataset.cost || 0);
    if (hiddenId) hiddenId.value = itemId;
    if (costEl && !costEl.value) costEl.value = cost.toFixed(2);
    // Show current stock hint
    if (hintEl && itemId) {
      apiFetch(`/api/stock/${itemId}/availability`).then(r => r?.json()).then(data => {
        const rows = Array.isArray(data) ? data : (data.data || []);
        const total = rows.reduce((s,r) => s + parseFloat(r.qty_available ?? r.qty_on_hand ?? 0), 0);
        hintEl.textContent = `Current total stock: ${total.toLocaleString()} units`;
        hintEl.style.color = total <= 0 ? 'var(--red)' : 'var(--text3)';
      }).catch(() => {});
    }
    inputEl.style.borderColor = '';
  } else {
    if (hiddenId) hiddenId.value = '';
    if (hintEl)   hintEl.textContent = '';
    // Only show error if user has typed enough to expect a match
    if (val.length > 2) inputEl.style.borderColor = 'var(--red)';
    else inputEl.style.borderColor = '';
  }
}

async function saveAdjustment() {
  const reason    = document.getElementById('adjReason').value;
  const warehouseId = document.getElementById('adjWarehouse').value;
  const notes     = document.getElementById('adjNotes').value.trim();
  let valid = true;

  if (!reason)      { document.getElementById('errAdjReason').textContent = 'Required'; valid=false; }
  else               { document.getElementById('errAdjReason').textContent = ''; }
  if (!warehouseId) { document.getElementById('errAdjWarehouse').textContent = 'Required'; valid=false; }
  else               { document.getElementById('errAdjWarehouse').textContent = ''; }
  if (!valid) return;

  const lineEls = document.querySelectorAll('#adjLines div[id^="line_"]');
  const lines   = [];
  for (const row of lineEls) {
    const itemId = row.querySelector('.adj-item-id')?.value
                || row.querySelector('.adj-item-sel')?.value; // fallback
    const qty    = parseFloat(row.querySelector('.adj-qty')?.value);
    const cost   = parseFloat(row.querySelector('.adj-cost')?.value) || 0;
    if (itemId && !isNaN(qty) && qty !== 0) lines.push({ item_id: itemId, qty_actual: qty, cost_per_unit: cost });
  }
  if (!lines.length) { toast('warning', 'No Lines', 'Add at least one valid line item.'); return; }

  const btn = document.getElementById('adjSaveBtn');
  btn.disabled = true; btn.textContent = 'Savingâ€¦';

  try {
    const res = await apiFetch('/api/adjustments', {
      method: 'POST',
      body: JSON.stringify({ reason, warehouse_id: warehouseId, notes, lines })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Failed to create adjustment');
    closeModal('adjModal');
    toast('success', 'Adjustment Created', `Draft ${data.number || ''} saved`);
    loadAdjustments();
  } catch(e) {
    toast('error', 'Save Failed', e.message);
  } finally {
    btn.disabled = false; btn.textContent = 'Save Draft';
  }
}

async function postAdjustment(id, btnEl) {
  if (!confirm('Post this adjustment? This will update stock levels and cannot be undone.')) return;
  const origText = btnEl.textContent;
  btnEl.disabled = true; btnEl.textContent = 'Postingâ€¦';
  try {
    const res = await apiFetch(`/api/adjustments/${id}/post`, { method: 'POST' });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Failed to post');
    toast('success', 'Adjustment Posted', 'Stock levels have been updated.');
    loadAdjustments();
    loadKPIs();
  } catch(e) {
    toast('error', 'Post Failed', e.message);
    btnEl.disabled = false; btnEl.textContent = origText;
  }
}

async function deleteAdjustment(id, btnEl) {
  if (!confirm('Delete this draft adjustment?')) return;
  try {
    const res = await apiFetch(`/api/adjustments/${id}`, { method: 'DELETE' });
    if (res && res.ok) {
      toast('success', 'Deleted', 'Draft adjustment removed.');
      loadAdjustments();
    } else {
      const data = await res?.json();
      toast('error', 'Delete Failed', data?.error || 'Could not delete');
    }
  } catch(e) { toast('error', 'Error', e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUICK CREATE PO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _vendorsCache = [];
let _quickPOItem  = null;

async function openQuickPO(itemId, itemName, itemCode, shortfall, reorderQty) {
  _quickPOItem = { itemId, itemName, itemCode, shortfall, reorderQty };

  // Item summary card
  const suggestedQty = parseFloat(reorderQty) || parseFloat(shortfall) || 1;
  document.getElementById('quickPOItemSummary').innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700;color:var(--text0)">${itemName}</div>
        <div style="font-size:11px;color:var(--text2);margin-top:2px">SKU: ${itemCode}</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:11px;color:var(--text2)">Shortfall</div>
        <div style="font-weight:700;color:var(--red);font-size:16px">${fmtNum(shortfall)} units</div>
      </div>
    </div>
  `;

  document.getElementById('quickPOItemId').value = itemId;
  document.getElementById('quickPOQty').value    = Math.ceil(suggestedQty);
  // Default expected date = 14 days from now
  const d = new Date(); d.setDate(d.getDate() + 14);
  document.getElementById('quickPODate').value = d.toISOString().slice(0, 10);
  document.getElementById('quickPONotes').value = '';
  document.getElementById('errQuickPOVendor').textContent   = '';
  document.getElementById('errQuickPOWarehouse').textContent = '';

  // Load vendors and warehouses into dropdowns
  await Promise.all([loadQuickPOVendors(), loadQuickPOWarehouses()]);
  openModal('quickPOModal');
}

async function loadQuickPOVendors() {
  const sel = document.getElementById('quickPOVendor');
  if (_vendorsCache.length === 0) {
    try {
      const res = await apiFetch('/api/vendors');
      if (!res) return;
      const data = await res.json();
      _vendorsCache = Array.isArray(data) ? data : (data.data || []);
    } catch { return; }
  }
  sel.innerHTML = '<option value="">Select vendorâ€¦</option>' +
    _vendorsCache.map(v => `<option value="${v.id}">${v.name}</option>`).join('');
}

async function loadQuickPOWarehouses() {
  const sel = document.getElementById('quickPOWarehouse');
  try {
    const res = await apiFetch('/api/warehouses');
    if (!res) return;
    const data = await res.json();
    const whs  = Array.isArray(data) ? data : (data.data || []);
    sel.innerHTML = '<option value="">Select warehouseâ€¦</option>' +
      whs.map(w => `<option value="${w.id}">${w.name}</option>`).join('');
  } catch {}
}

async function submitQuickPO() {
  const vendorId    = document.getElementById('quickPOVendor').value;
  const warehouseId = document.getElementById('quickPOWarehouse').value;
  const qty         = parseFloat(document.getElementById('quickPOQty').value);
  const itemId      = document.getElementById('quickPOItemId').value;
  const expDate     = document.getElementById('quickPODate').value;
  const notes       = document.getElementById('quickPONotes').value.trim();
  let valid = true;

  if (!vendorId)    { document.getElementById('errQuickPOVendor').textContent   = 'Required'; valid = false; }
  else               { document.getElementById('errQuickPOVendor').textContent   = ''; }
  if (!warehouseId) { document.getElementById('errQuickPOWarehouse').textContent = 'Required'; valid = false; }
  else               { document.getElementById('errQuickPOWarehouse').textContent = ''; }
  if (!valid) return;

  const btn = document.getElementById('quickPOBtn');
  btn.disabled = true; btn.textContent = 'Creatingâ€¦';

  try {
    const res  = await apiFetch('/api/purchase-orders', {
      method: 'POST',
      body: JSON.stringify({
        vendor_id:     vendorId,
        warehouse_id:  warehouseId,
        expected_date: expDate || null,
        notes:         notes || null,
        lines: [{ item_id: itemId, qty_ordered: qty }]
      })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Failed to create PO');

    closeModal('quickPOModal');
    const poNumber = data.number || data.data?.number || '';

    // Show success toast with link to purchasing
    const c = document.getElementById('toast-container');
    const t = document.createElement('div');
    t.className = 'toast success';
    t.innerHTML = `
      <span class="toast-icon">âœ…</span>
      <div class="toast-body">
        <div class="toast-title">PO Created â€” ${poNumber}</div>
        <div class="toast-msg">Draft purchase order ready. <a href="/purchasing" style="color:#34d399;font-weight:600">Open Purchasing â†’</a></div>
      </div>
      <button class="toast-close" onclick="this.closest('.toast').remove()">âœ•</button>
    `;
    c.appendChild(t);
    setTimeout(() => { t.style.animation='slideOut .25s ease forwards'; setTimeout(()=>t.remove(),250); }, 7000);

  } catch(e) {
    toast('error', 'PO Failed', e.message);
  } finally {
    btn.disabled = false; btn.textContent = 'Create Draft PO';
  }
}
</script>
</body>
</html>
